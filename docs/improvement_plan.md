# 小红书助手改进计划

## 1. 数据结构设计

### 1.1 域名规则与Cookie模板关联
```javascript
// 存储结构示例
{
  "domain_rules": {
    "example.com": {
      "rules": ["^example\.com$", "^*.example\.com$"],
      "template_id": "example_com_template"
    }
  },
  "cookie_templates": {
    "example_com_template": {
      "domain": "example.com",
      "requiredFields": ["sessionid", "user_token"],
      "template": {...}
    }
  }
}
```

### 1.2 数据迁移方案
1. 创建新的存储结构
2. 将现有域名规则和Cookie模板数据迁移到新结构
3. 保留向后兼容性，确保旧版本功能不受影响

## 2. 界面优化

### 2.1 域名规则与模板管理界面
1. 合并域名规则和Cookie模板的显示
2. 为每个域名显示其关联的规则和模板信息
3. 提供直观的编辑和管理操作

### 2.2 批量操作界面
1. 添加导入/导出功能按钮
2. 设计批量操作的确认和进度提示
3. 提供导入文件格式说明

## 3. 功能实现

### 3.1 域名规则添加/编辑
1. 添加规则时自动创建或关联Cookie模板
2. 提供模板选择或创建的交互界面
3. 实现规则和模板的同步更新

### 3.2 自动验证机制
1. 监听域名访问事件
2. 根据域名查找对应的规则和模板
3. 使用模板验证Cookie有效性

### 3.3 批量导入导出
1. 实现JSON格式的数据导出
2. 支持批量导入并验证数据格式
3. 处理导入时的冲突情况

## 4. 实施步骤

### 4.1 第一阶段：基础改造（已完成）
1. 实现数据结构改造
   - 创建了StorageManager类，用于统一管理域名规则和Cookie模板
   - 设计了新的数据结构，将域名规则与Cookie模板关联
2. 更新存储机制
   - 实现了新的存储键名和数据结构
   - 添加了数据迁移功能，确保旧数据平滑迁移到新结构
3. 修改现有代码以适应新结构
   - 修改了background.js，集成了新的存储管理模块
   - 更新了domainMatcher.js，使用新的数据结构处理域名规则
   - 改造了cookieTemplate.js，适配新的存储结构

### 4.2 第二阶段：功能开发（已完成）
1. 开发新的用户界面
2. 实现规则和模板关联功能
3. 开发自动验证机制

### 4.3 第三阶段：批量功能
1. 实现导入导出功能
2. 开发批量操作界面
3. 进行功能测试和优化

## 5. 注意事项

1. 确保数据迁移的安全性和完整性
2. 保持良好的错误处理和用户提示
3. 注意性能优化，特别是在处理大量数据时
4. 提供充分的使用说明和帮助文档